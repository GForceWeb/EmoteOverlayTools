import{h as u,g as y}from"./main-ROiFbYVS.js";import{g as P}from"./index-Brfk6Bdo.js";import"./defaultConfig-CxZCM2FP.js";const D=new Map;let E=-1,v=null;function W(){const t=document.documentElement,a=getComputedStyle(t).getPropertyValue("--emote-size-standard");return parseInt(a)||75}function k(t,a=20,h=200){let s=t.length;for(let o=0;o<a;o++){let n=o%s;setTimeout(async()=>{await R(t[n])},o*h)}}async function R(t){const a=W(),h=100,s=6,o=200;let n=null;for(let e=0;e<s&&!n;e++){e>0&&await u.delay(o+e*100);let d=[],c=!1;v!==null&&(e<3?(c=!0,d=[]):e<5?(c=!1,d=E!==-1?[E]:[]):(c=!1,d=[]));for(let l=0;l<h;l++){const r=U(a,d,c?v:null);if(!A(r,a)){n=r,(e>0||c)&&console.log(`Found ${c?"perpendicular":"any"} path on round ${e+1}, attempt ${l+1}`);break}}}if(!n){console.log(`No non-colliding path found after ${s} rounds of ${h} attempts each`);return}E=n.side,v=n.direction;var i=document.createElement("div");i.id=y.divnumber.toString(),y.divnumber++,P.set(i,{className:"traffic-element",x:n.startX,y:n.startY,z:u.Randomizer(-100,100),rotation:u.Randomizer(-5,5),backgroundImage:"url("+t+")"}),y.warp.appendChild(i);const w={id:i.id,direction:n.direction,position:n.position,startTime:Date.now(),speed:n.speed,isHorizontal:n.direction==="horizontal",startPos:n.direction==="horizontal"?n.startX:n.startY,endPos:n.direction==="horizontal"?n.endX:n.endY};D.set(i.id,w),H(i,n)}function U(t,a=[],h=null){let s=[0,1,2,3];h!==null&&(h==="horizontal"?s=s.filter(i=>i===0||i===2):s=s.filter(i=>i===1||i===3)),s=s.filter(i=>!a.includes(i));const o=s[Math.floor(Math.random()*s.length)],n=u.Randomizer(300,1e3);switch(o){case 0:let i=t,w=innerWidth-t;if(innerWidth>innerHeight){const p=innerWidth*.2;i=Math.max(i,p),w=Math.min(w,innerWidth-p)}const e=u.Randomizer(i,w);return{startX:e,startY:-t,endX:e,endY:innerHeight+t,direction:"vertical",position:e,speed:n,side:0};case 1:const d=u.Randomizer(t,innerHeight-t);return{startX:-t,startY:d,endX:innerWidth+t,endY:d,direction:"horizontal",position:d,speed:n,side:1};case 2:let c=t,l=innerWidth-t;if(innerWidth>innerHeight){const p=innerWidth*.2;c=Math.max(c,p),l=Math.min(l,innerWidth-p)}const r=u.Randomizer(c,l);return{startX:r,startY:innerHeight+t,endX:r,endY:-t,direction:"vertical",position:r,speed:n,side:2};case 3:default:const f=u.Randomizer(t,innerHeight-t);return{startX:innerWidth+t,startY:f,endX:-t,endY:f,direction:"horizontal",position:f,speed:n,side:3}}}function A(t,a){const h=Date.now(),s=t.direction==="horizontal",o=s?t.startX:t.startY,n=s?t.endX:t.endY,i=n>o?1:-1;for(const[w,e]of D.entries()){const d=e.endPos>e.startPos?1:-1;if(e.direction!==t.direction){const c=s?e.position:t.position,l=s?t.position:e.position,f=Math.abs(s?c-t.startX:l-t.startY)/t.speed*1e3,p=e.startPos+(h-e.startTime)/1e3*e.speed*d,M=Math.abs(s?l-p:c-p)/e.speed*1e3,m=Math.abs(f-M),x=a*2/Math.min(t.speed,e.speed)*1e3;if(m<x)return!0}else if(Math.abs(t.position-e.position)<a*1.5){const l=(h-e.startTime)/1e3,r=e.startPos+l*e.speed*d;if(i!==d){const f=t.speed+e.speed,X=Math.abs(o-r)/f*1e3,M=o+X/1e3*t.speed*i,m=r+X/1e3*e.speed*d,x=Math.min(o,n),T=Math.max(o,n),b=Math.min(r,e.endPos),g=Math.max(r,e.endPos),Y=M>=x&&M<=T,C=m>=b&&m<=g;if(Y&&C&&Math.abs(M-m)<a*2)return!0}else if((i>0?o<r:o>r)&&t.speed>e.speed){const p=t.speed-e.speed,M=Math.abs(o-r)/p*1e3,m=o+M/1e3*t.speed*i,x=r+M/1e3*e.speed*d,T=Math.min(o,n),b=Math.max(o,n),g=Math.min(r,e.endPos),Y=Math.max(r,e.endPos),C=m>=T&&m<=b,I=x>=g&&x<=Y;if(C&&I&&Math.abs(m-x)<a*2)return!0}}}return!1}function H(t,a,h){const s=Math.abs(a.endX-a.startX),o=Math.abs(a.endY-a.startY),i=Math.max(s,o)/a.speed;P.to(t,{x:a.endX,y:a.endY,duration:i,ease:"none"}),P.to(t,{rotation:"+=5",duration:u.Randomizer(1.5,2.5),repeat:Math.ceil(i/2),yoyo:!0,ease:"sine.inOut"}),P.fromTo(t,{opacity:0},{opacity:1,duration:.3,ease:"power2.out"}),P.to(t,{opacity:0,duration:.5,ease:"power2.in",delay:i-.5}),setTimeout(()=>{D.delete(t.id),u.removeelement(t.id)},i*1e3+100)}export{k as traffic};
